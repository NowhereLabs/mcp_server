// MCP Dashboard Alpine.js Bundle - Built 2025-07-18T22:19:15.616Z
"use strict";(()=>{var a={VALIDATION:"validation",NETWORK:"network",SECURITY:"security",SYSTEM:"system",USER:"user",UNKNOWN:"unknown"},c={LOW:"low",MEDIUM:"medium",HIGH:"high",CRITICAL:"critical"};function b(t){let e=["validation","invalid","required","missing","empty","null","undefined","format","syntax","parse","malformed","expected","must be","cannot be","too short","too long","out of range","not allowed","schema","type error"],r=t.message.toLowerCase(),o=t.name.toLowerCase();return e.some(s=>r.includes(s)||o.includes(s))||t.name==="TypeError"||t.name==="SyntaxError"}function w(t){let e=["network","fetch","request","response","connection","timeout","abort","offline","cors","http","ssl","tls","dns","socket","refused","unreachable","gateway","proxy","status 4","status 5"],r=t.message.toLowerCase(),o=t.name.toLowerCase();return e.some(s=>r.includes(s)||o.includes(s))||/failed to fetch|network error|load failed/i.test(t.message)}function x(t){let e=["security","permission","unauthorized","forbidden","access denied","authentication","authorization","token","csrf","xss","injection","blocked","restricted","credentials","login","session expired"],r=t.message.toLowerCase(),o=t.name.toLowerCase();return e.some(s=>r.includes(s)||o.includes(s))||/status 40[13]/i.test(t.message)}function D(t){let e=["memory","disk","file system","database","server","internal","crash","overflow","stack","heap","resource","quota","limit","unavailable","maintenance","overload","capacity"],r=t.message.toLowerCase(),o=t.name.toLowerCase();return e.some(s=>r.includes(s)||o.includes(s))||/status 50\d/i.test(t.message)||t.name==="RangeError"||t.name==="ReferenceError"}function R(t){let e=["user","input","action","operation","cancelled","aborted","interrupted","duplicate","already exists","not found","empty result"],r=t.message.toLowerCase(),o=t.name.toLowerCase();return e.some(s=>r.includes(s)||o.includes(s))||/status 404|status 409|status 410/i.test(t.message)}var u=class extends Error{constructor(r,o=a.UNKNOWN,s=c.MEDIUM,i={}){super(r);this.name="StandardError";this.type=o,this.severity=s,this.details=i,this.timestamp=new Date().toISOString(),this.userMessage=this.getUserFriendlyMessage()}getUserFriendlyMessage(){let r={[a.VALIDATION]:"Please check your input and try again.",[a.NETWORK]:"Network connection issue. Please try again.",[a.SECURITY]:"Security error. Please contact support.",[a.SYSTEM]:"System error. Please try again later.",[a.USER]:this.message,[a.UNKNOWN]:"An unexpected error occurred. Please try again."};return r[this.type]||r[a.UNKNOWN]}toJSON(){return{name:this.name,message:this.message,type:this.type,severity:this.severity,details:this.details,timestamp:this.timestamp,userMessage:this.userMessage}}},n=class{static sanitizeStackTrace(e){if(e)return e.split(`
`).map(r=>{if(!r.trim().startsWith("at "))return r;let o=r.match(/at\s+([^(]+)/);return o?`    at ${o[1].trim()}`:"    at <sanitized>"}).slice(0,5).join(`
`)}static createValidationError(e,r={}){return new u(e,a.VALIDATION,c.LOW,r)}static createNetworkError(e,r={}){return new u(e,a.NETWORK,c.MEDIUM,r)}static createSecurityError(e,r={}){return new u(e,a.SECURITY,c.HIGH,r)}static createSystemError(e,r={}){return new u(e,a.SYSTEM,c.MEDIUM,r)}static createUserError(e,r={}){return new u(e,a.USER,c.LOW,r)}static getErrorAnalysis(e){let r={[a.VALIDATION]:{category:"Input Validation",suggestions:["Check that all required fields are filled","Verify data format matches expected pattern","Ensure values are within acceptable ranges"],isRecoverable:!0,userAction:"Please correct your input and try again"},[a.NETWORK]:{category:"Network/Connectivity",suggestions:["Check your internet connection","Try refreshing the page","Check if the server is accessible","Verify proxy/firewall settings"],isRecoverable:!0,userAction:"Please check your connection and retry"},[a.SECURITY]:{category:"Security/Authentication",suggestions:["Verify your login credentials","Check if your session has expired","Ensure you have proper permissions","Contact administrator if needed"],isRecoverable:!1,userAction:"Authentication required - please log in again"},[a.SYSTEM]:{category:"System/Server",suggestions:["Wait a moment and try again","Check system status page","Contact technical support","Save your work and restart the application"],isRecoverable:!1,userAction:"System issue detected - please try again later"},[a.USER]:{category:"User Operation",suggestions:["Review the requested operation","Check if the resource exists","Verify you have the right permissions","Try a different approach"],isRecoverable:!0,userAction:"Please review your action and try again"},[a.UNKNOWN]:{category:"Unknown",suggestions:["Try refreshing the page","Check browser console for details","Contact support with error details","Try again in a few minutes"],isRecoverable:!0,userAction:"Unexpected error - please try again"}};return r[e.type]||r[a.UNKNOWN]}static handleError(e,r="unknown"){if(e instanceof u)return e;let o="An unexpected error occurred",s=a.UNKNOWN,i=c.MEDIUM,d={context:r};return e instanceof Error?(o=e.message,d.originalError=e.name,d.stack=this.sanitizeStackTrace(e.stack),b(e)?(s=a.VALIDATION,i=c.LOW):w(e)?(s=a.NETWORK,i=c.MEDIUM):x(e)?(s=a.SECURITY,i=c.HIGH):D(e)?(s=a.SYSTEM,i=c.HIGH):R(e)&&(s=a.USER,i=c.LOW)):typeof e=="string"?o=e:e!=null&&(typeof e=="object"?(o="An unexpected error occurred",d.originalError=e.toString()):o=String(e)),new u(o,s,i,d)}static logError(e,r="unknown"){let o={component:r,error:e.toJSON(),timestamp:new Date().toISOString()};switch(e.severity){case c.CRITICAL:break;case c.HIGH:break;case c.MEDIUM:break;case c.LOW:break;default:}}static showErrorToUser(e,r="unknown"){if(typeof window<"u"&&window.Alpine?.store("notifications")){let o="error";switch(e.severity){case c.CRITICAL:case c.HIGH:o="error";break;case c.MEDIUM:o="warning";break;case c.LOW:o="info";break}window.Alpine.store("notifications").add(e.userMessage,o,e.severity===c.CRITICAL?1e4:5e3)}}static processError(e,r="unknown",o="unknown"){let s=this.handleError(e,o);return this.logError(s,r),this.showErrorToUser(s,r),s}};function p(){typeof window>"u"||(window.addEventListener("unhandledrejection",t=>{let e=n.processError(t.reason,"global","unhandledrejection");t.preventDefault()}),window.addEventListener("error",t=>{let e=n.processError(t.error||t.message,"global","global_error")}),document.addEventListener("alpine:error",t=>{let e=t,r=n.processError(e.detail.error,"alpine","alpine_error")}))}typeof window<"u"&&p();function f(){return{get metrics(){return this.$store.metrics.data},get loading(){return this.$store.metrics.loading},initializeUpdates(){this.$store.metrics.setLoading(!0)},updateMetrics(t){try{let e=JSON.parse(t.detail.xhr.response);this.$store.metrics.update(e)}catch(e){let r=n.processError(e,"metricsStore","updateMetrics_json_parsing");n.showErrorToUser(r,"metricsStore"),this.$store.metrics.setLoading(!1)}}}}typeof document<"u"&&document.addEventListener("alpine:init",()=>{typeof window<"u"&&window.Alpine&&window.Alpine.store("metrics",{data:{total_tool_calls:0,success_rate:0,active_sessions:0,avg_duration_ms:0,tools_available:0,resources_available:0},loading:!1,error:null,history:[],update(t){this.data={...this.data,...t},this.loading=!1,this.addMetric({timestamp:Date.now(),value:t.total_tool_calls,type:"update",total_tool_calls:t.total_tool_calls,success_rate:t.success_rate})},setLoading(t){this.loading=t},setError(t){this.error=t},addMetric(t){this.history.push(t),this.history.length>100&&this.history.shift()},clear(){this.data={total_tool_calls:0,success_rate:0,active_sessions:0,avg_duration_ms:0,tools_available:0,resources_available:0},this.history=[],this.loading=!1,this.error=null},getByType(t){return this.history.filter(e=>e.type===t)},getLatest(t){let e=this.getByType(t);return e.length>0?e[e.length-1]:void 0},getMetricsInRange(t,e){return this.history.filter(r=>r.timestamp>=t&&r.timestamp<=e)},getAverageValue(t){let e=this.getByType(t);return e.length===0?0:e.reduce((o,s)=>o+s.value,0)/e.length}})});function h(){return{get events(){return this.$store.eventStream.events},initializeSSE(){},handleSSEMessage(t){try{let e=JSON.parse(t.detail.data),r=this.sanitizeEventData(e);this.$store.eventStream.addEvent(r)}catch(e){this.handleEventStreamError(e,"handleSSEMessage",[t])}},handleEventStreamError(t,e,r=[]){let o=n.processError(t,"eventStream",`${e}_event_stream_processing`);n.showErrorToUser(o,"eventStream");try{this.$store.eventStream.addEvent({type:"error",message:"Error processing event stream",timestamp:new Date().toISOString()})}catch(s){n.processError(s,"eventStream","fallbackErrorEvent")}},sanitizeEventData(t){try{let e={},r=["type","name","message","uri","timestamp"];for(let s of r)t[s]!==void 0&&(e[s]=this.sanitizeString(t[s]));return e.timestamp&&!isNaN(Date.parse(e.timestamp))?e.timestamp=new Date(e.timestamp).toISOString():e.timestamp=new Date().toISOString(),{type:e.type||"unknown",timestamp:e.timestamp,...e}}catch(e){return this.handleEventStreamError(e,"sanitizeEventData",[t]),{type:"error",message:"Failed to process event data",timestamp:new Date().toISOString()}}},sanitizeString(t){if(typeof t!="string")return String(t);t.length>500&&(t=t.substring(0,500)+"...");let e=document.createElement("div");return e.textContent=t,e.innerHTML},getEventClass(t){let e={error:"bg-red-900 bg-opacity-30 text-red-300 border-red-500",tool_called:"bg-green-900 bg-opacity-30 text-green-300 border-green-500",default:"bg-blue-900 bg-opacity-30 text-blue-300 border-blue-500"};return e[t]||e.default},formatEvent(t){try{let r=`[${new Date(t.timestamp).toLocaleTimeString()}] ${t.type||"unknown"}`;return t.name&&(r+=`: ${t.name}`),t.message&&(r+=`: ${t.message}`),t.uri&&(r+=`: ${t.uri}`),t.id&&(r+=` (${t.id})`),r}catch{return"[Invalid event data]"}}}}typeof document<"u"&&document.addEventListener("alpine:init",()=>{typeof window<"u"&&window.Alpine&&window.Alpine.store("eventStream",{events:[],maxEvents:20,addEvent(t){if(!t||typeof t!="object")return;let e={...t,id:(Date.now()+Math.random()).toString()};this.events.unshift(e),this.events.length>this.maxEvents&&this.events.pop()},clear(){this.events=[]}})});function E(){return{hasError:!1,errorMessage:null,e:null,init(){this.setupErrorHandling()},setupErrorHandling(){let t=this.remove;this.remove=e=>{try{return t.call(this,e)}catch(r){this.handleComponentError(r,"remove",[e])}},this.e=e=>{this.handleComponentError(e.error||new Error(e.message),"globalError")},window.addEventListener("error",this.e)},get notifications(){try{return this.$store.notifications?.items||[]}catch(t){return this.handleComponentError(t,"notifications getter"),[]}},remove(t){try{this.$store.notifications.remove(t.toString())}catch(e){this.handleComponentError(e,"remove",[t])}},getNotificationClass(t){try{let e={success:"bg-green-900 text-green-300 border-green-700",error:"bg-red-900 text-red-300 border-red-700",warning:"bg-yellow-900 text-yellow-300 border-yellow-700",info:"bg-blue-900 text-blue-300 border-blue-700"};return e[t]||e.info}catch(e){return this.handleComponentError(e,"getNotificationClass",[t]),"bg-blue-900 text-blue-300 border-blue-700"}},handleComponentError(t,e,r=[]){this.hasError=!0,this.errorMessage=t.message||"Notification component error";let o=n.processError(t,"notificationSystem",e);setTimeout(()=>{this.recoverFromError()},2e3)},recoverFromError(){this.hasError=!1,this.errorMessage=null;try{this.setupErrorHandling()}catch{}},destroy(){this.$store.notifications.clear(),this.e&&(window.removeEventListener("error",this.e),this.e=null)}}}function T(t){let e=document.createElement("div");return e.textContent=t,e.innerHTML}function C(t){return typeof t!="string"?"Invalid message format":(t.length>1e3&&(t=t.substring(0,1e3)+"..."),T(t))}typeof document<"u"&&document.addEventListener("alpine:init",()=>{typeof window<"u"&&window.Alpine&&window.Alpine.store("notifications",{items:[],add(t,e="info",r=5e3){try{let o=C(t),i=["success","error","warning","info"].includes(e)?e:"info",d=Math.max(0,Math.min(r,3e4)),m={id:(Date.now()+Math.random()).toString(),message:o,type:i,timestamp:Date.now(),duration:d};this.items.push(m),d>0&&setTimeout(()=>{this.remove(m.id)},d)}catch{this.items.push({id:(Date.now()+Math.random()).toString(),message:"Error processing notification",type:"error",timestamp:Date.now(),duration:5e3})}},remove(t){this.items=this.items.filter(e=>e.id!==t)},clear(){this.items=[]},getByType(t){return this.items.filter(e=>e.type===t)},getCount(){return this.items.length},getCountByType(t){return this.items.filter(e=>e.type===t).length}})});function g(t){return{toolName:t,loading:!1,lastResult:null,executionHistory:[],async execute(e={}){this.loading=!0;let r=(Date.now()+Math.random()).toString(),o=Date.now();try{let i=await(await fetch("/api/tools/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.toolName,arguments:e})})).json(),m=Date.now()-o;return this.lastResult={id:r,success:i.success,result:i.result,error:i.error,duration:m,timestamp:new Date().toISOString(),args:e},this.executionHistory.unshift(this.lastResult),this.executionHistory.length>10&&this.executionHistory.pop(),i.success?(this.$store.notifications.add(`Tool "${this.toolName}" executed successfully (${m}ms)`,"success"),this.$store.dashboard.refreshAll()):this.$store.notifications.add(`Tool execution failed: ${i.error}`,"error"),i}catch(s){let i=n.processError(s,"toolExecutor",`execute_${this.toolName}`),d={id:r,success:!1,error:i.message,duration:Date.now()-o,timestamp:new Date().toISOString(),args:e};throw this.lastResult=d,this.executionHistory.unshift(d),n.showErrorToUser(i,"toolExecutor"),i}finally{this.loading=!1}},getSuccessRate(){if(this.executionHistory.length===0)return 0;let e=this.executionHistory.filter(r=>r.success).length;return Math.round(e/this.executionHistory.length*100)},getAverageExecutionTime(){if(this.executionHistory.length===0)return 0;let e=this.executionHistory.reduce((r,o)=>r+o.duration,0);return Math.round(e/this.executionHistory.length)},clearHistory(){this.executionHistory=[],this.lastResult=null}}}typeof window<"u"&&window.addEventListener("alpine:init",()=>{window.Alpine&&window.Alpine.store("toolExecution",{activeExecutions:new Map,getExecutor(t){return this.activeExecutions.has(t)||this.activeExecutions.set(t,g(t)),this.activeExecutions.get(t)},async executeGlobal(t,e={}){return await this.getExecutor(t).execute(e)},getToolStats(t){let e=this.activeExecutions.get(t);return e?{executions:e.executionHistory.length,successRate:e.getSuccessRate(),averageTime:e.getAverageExecutionTime(),lastResult:e.lastResult}:null},getAllStats(){let t={};return this.activeExecutions.forEach((e,r)=>{let o=this.getToolStats(r);o&&(t[r]=o)}),t},clearAllHistory(){this.activeExecutions.forEach(t=>{t.clearHistory()})},getTotalExecutions(){let t=0;return this.activeExecutions.forEach(e=>{t+=e.executionHistory.length}),t},getOverallSuccessRate(){let t=0,e=0;return this.activeExecutions.forEach(r=>{t+=r.executionHistory.length,e+=r.executionHistory.filter(o=>o.success).length}),t>0?Math.round(e/t*100):0}})});function l(t){return window.Alpine.store(t)}function v(){document.body.addEventListener("htmx:afterSwap",function(t){let e=t,r=e.detail.target;if(r.id==="metrics-data")try{let o=JSON.parse(e.detail.xhr.response);l("metrics").update(o)}catch{l("notifications").add("Error updating metrics","error")}if(r.id==="status-data")try{let o=JSON.parse(e.detail.xhr.response);l("status").update(o)}catch{}if(r.id==="tool-calls-data")try{let o=JSON.parse(e.detail.xhr.response);l("toolCalls").update(o)}catch{}}),document.body.addEventListener("htmx:beforeRequest",function(t){let r=t.detail.target;r.id==="metrics-data"&&l("metrics").setLoading(!0),r.id==="status-data"&&l("status").setLoading(!0)}),document.body.addEventListener("htmx:responseError",function(t){let e=t,r=e.detail.xhr.status,o=e.detail.target,s=`Request failed (${r})`;o.id==="metrics-data"?(s="Failed to load metrics",l("metrics").setLoading(!1)):o.id==="status-data"&&(s="Failed to load server status",l("status").setLoading(!1)),l("notifications").add(s,"error")}),document.body.addEventListener("htmx:sseMessage",function(t){let e=t;try{let r=JSON.parse(e.detail.data||"{}");l("eventStream").addEvent(r)}catch{}}),document.body.addEventListener("htmx:sseOpen",function(t){l("notifications").add("Live events connected","success"),l("dashboard").setSSEConnected(!0)}),document.body.addEventListener("htmx:sseError",function(t){l("notifications").add("Live events connection error","error"),l("dashboard").setSSEConnected(!1)}),document.body.addEventListener("htmx:sseClose",function(t){l("notifications").add("Live events disconnected","warning"),l("dashboard").setSSEConnected(!1)})}document.addEventListener("alpine:init",()=>{let t={sseConnected:!1,lastUpdate:null,setSSEConnected(o){this.sseConnected=o},triggerUpdate(o){typeof window<"u"&&window.htmx&&(window.htmx.trigger(`#${o}-data`,"htmx:trigger"),this.lastUpdate=new Date().toISOString())},refreshAll(){this.triggerUpdate("metrics"),this.triggerUpdate("status"),this.triggerUpdate("tool-calls")}};window.Alpine.store("dashboard",t);let e={data:{},loading:!1,update(o){this.data={...this.data,...o},this.loading=!1},setLoading(o){this.loading=o}};window.Alpine.store("status",e);let r={data:[],loading:!1,update(o){this.data=Array.isArray(o)?o:[],this.loading=!1},setLoading(o){this.loading=o}};window.Alpine.store("toolCalls",r)});function y(){return{refreshing:!1,autoRefresh:!0,refreshInterval:2e3,intervalId:null,init(){this.startAutoRefresh()},async refreshAll(){this.refreshing=!0;try{this.$store.dashboard.refreshAll(),this.$store.notifications.add("Dashboard refreshed","success")}catch(t){let e=n.processError(t,"dashboardControls","refreshAll_manual_refresh");n.showErrorToUser(e,"dashboardControls")}finally{this.refreshing=!1}},toggleAutoRefresh(){this.autoRefresh=!this.autoRefresh,this.autoRefresh?(this.startAutoRefresh(),this.$store.notifications.add("Auto-refresh enabled","info")):(this.stopAutoRefresh(),this.$store.notifications.add("Auto-refresh disabled","info"))},startAutoRefresh(){this.intervalId&&clearInterval(this.intervalId),this.autoRefresh&&(this.intervalId=setInterval(()=>{this.refreshing||this.$store.dashboard.refreshAll()},this.refreshInterval))},stopAutoRefresh(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},setRefreshInterval(t){this.refreshInterval=t,this.autoRefresh&&this.startAutoRefresh()},async clearAllData(){try{this.$store.metrics.data={total_tool_calls:0,success_rate:0,active_sessions:0,avg_duration_ms:0,tools_available:0,resources_available:0},this.$store.eventStream.clear(),this.$store.notifications.clear();let t=this.$store.toolExecution;t&&t.activeExecutions&&t.activeExecutions.forEach(e=>{e.clearHistory&&e.clearHistory()}),this.$store.notifications.add("All data cleared","success")}catch(t){let e=n.processError(t,"dashboardControls","clearAllData_data_clear");n.showErrorToUser(e,"dashboardControls")}},exportData(){try{let t={metrics:this.$store.metrics.data,events:this.$store.eventStream.events,toolStats:this.$store.toolExecution?.getAllStats?this.$store.toolExecution.getAllStats():{},timestamp:new Date().toISOString()},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(e),o=document.createElement("a");o.href=r,o.download=`mcp-dashboard-export-${new Date().toISOString().split("T")[0]}.json`,o.click(),URL.revokeObjectURL(r),this.$store.notifications.add("Data exported successfully","success")}catch(t){let e=n.processError(t,"dashboardControls","exportData_data_export");n.showErrorToUser(e,"dashboardControls")}},get connectionStatus(){return this.$store.dashboard.sseConnected?"connected":"disconnected"},get lastUpdate(){return this.$store.dashboard.lastUpdate}}}function S(){return{...h(),pauseStream:!1,maxEvents:50,togglePause(){this.pauseStream=!this.pauseStream,this.pauseStream?this.$store.notifications.add("Event stream paused","info"):this.$store.notifications.add("Event stream resumed","info")},handleSSEMessage(e){if(!this.pauseStream)try{let r=JSON.parse(e.detail.data);if(this.$store.eventStream.addEvent(r),r.type==="tool_called"){let o=this.$store.dashboard;o.triggerUpdate&&(o.triggerUpdate("metrics"),o.triggerUpdate("tool-calls"))}}catch(r){n.processError(r,"dashboardControls","initSSE_sse_message_parsing")}},filterEvents(e){return this.$store.eventStream.events.filter(r=>e==="all"||r.type===e)},clearEvents(){this.$store.eventStream.clear(),this.$store.notifications.add("Events cleared","info")}}}p();window.metricsStore=f;window.eventStream=h;window.notificationSystem=E;window.toolExecutor=t=>g(t||"default");window.dashboardControls=y;window.enhancedEventStream=S;document.addEventListener("DOMContentLoaded",()=>{try{if(window.Alpine)window.Alpine.start();else throw new Error("Alpine.js not found. Please include Alpine.js before this script.")}catch(t){n.processError(t,"AlpineInit","initialization")}});document.addEventListener("alpine:init",()=>{try{v()}catch(t){n.processError(t,"HTMXAlpineBridge","initialization")}});})();
